<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login • SkySaver</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="join.css" />
    <style></style>
  </head>
  <body>
    <video autoplay muted loop playsinline id="bgVideo">
      <source
        src="grok-video-00ca20cc-9ca3-443e-a754-c6a2870d3e77.mp4"
        type="video/mp4"
      />
    </video>
    <div class="overlay"></div>

    <header>
      <div class="logo"><span style="color: blue">SKY</span>Saver</div>
      <nav>
        <a href="index.html">Home</a>
        <a href="portfolio.html">Portfolio</a>
        <a href="services.html">Services</a>
        <a href="contact.html">Contact</a>
      </nav>
    </header>

    <div class="container">
      <div class="box">
        <h1>Client Portal</h1>
        <p>Log in to track your build</p>

        <div id="loginForm">
          <input type="email" id="email" placeholder="Email" required />
          <input
            type="password"
            id="password"
            placeholder="Password"
            required
          />
          <button id="loginBtn">Enter Portal</button>
          <div class="message" id="message"></div>
          <div class="extra">
            <a href="#" id="forgotLink">Forgot password?</a> •
            <a href="signup.html">Create account</a>
          </div>
        </div>

        <div id="loggedIn" style="display: none">
          <h2>Welcome back!</h2>
          <p>You're in the client zone.</p>
          <button id="logoutBtn">Logout</button>
        </div>
      </div>
    </div>

    <script>
      const supabase = window.supabase.createClient(
        "https://gsqojmxyipceatskwbze.supabase.co",
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdzcW9qbXh5aXBjZWF0c2t3YnplIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMyMDI2NjYsImV4cCI6MjA3ODc3ODY2Nn0.gWkHKu0jOrUbIsBJZRdwP6xw-v2TJOXJ_Mc2kTaUHwc"
      );

      const loginBtn = document.getElementById("loginBtn");
      const logoutBtn = document.getElementById("logoutBtn");
      const message = document.getElementById("message");

      async function checkSession() {
        const {
          data: { session },
        } = await supabase.auth.getSession();
        if (session) {
          document.getElementById("loginForm").style.display = "none";
          document.getElementById("loggedIn").style.display = "block";
        }
      }
      checkSession();

      loginBtn.onclick = async () => {
        const email = document.getElementById("email").value.trim();
        const password = document.getElementById("password").value;
        const { error } = await supabase.auth.signInWithPassword({
          email,
          password,
        });
        if (error)
          (message.textContent = error.message),
            (message.style.color = "#ff6b6b");
        else location.reload();
      };

      logoutBtn.onclick = async () => {
        await supabase.auth.signOut();
        location.reload();
      };

      document.getElementById("forgotLink").onclick = (e) => {
        e.preventDefault();
        const email = prompt("Enter your email:");
        if (email)
          alert("Password reset link sent! (Check console in production)");
      };
    </script>
  </body>
</html>
